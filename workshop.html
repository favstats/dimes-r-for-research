<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Package Development in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="     Fabio Votta     Â favstats     Â www.favstats.eu     Â develop-rpkgs.netlify.app    2025-01-29" />
    <script src="libs/header-attrs-2.30/header-attrs.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Package Development in R
]
.author[
### <br><br><br><br> Fabio Votta <br><br> <a href="http://github.com/favstats"> <i class="fa fa-github fa-fw"></i>Â favstats </a> <br> <a href="http://www.favstats.eu/"> <i class="fa fa-address-card"></i>Â www.favstats.eu </a> <br> <a href="https://develop-rpkgs.netlify.app/"> <i class="fa fa-paper-plane fa-fw"></i>Â develop-rpkgs.netlify.app </a> <br><br>2025-01-29
]

---


&lt;style&gt;
.onehundredtwenty {
  font-size: 120%;
   }

.ninety {
  font-size: 90%;
   }

.eightyfive {
  font-size: 85%;
   }
   
.eighty {
  font-size: 80%;
   }
   
.seventyfive {
  font-size: 75%;
   }
   
.seventy {
  font-size: 70%;
   }
   
.fivty {
  font-size: 50%;
   }

/* Style plain code blocks to match R code chunks */
.remark-code {
  background-color: #f5f5f5 !important;
  color: #333333 !important;
  border: 1px solid #ddd !important;
  border-radius: 6px !important;
  display: block !important;
  overflow: hidden !important;
}

/* Ensure code lines also have the background */
.remark-code-line {
  background-color: #f5f5f5 !important;
  color: #333333 !important;
  display: block;
  padding: 0 0.8em;
}

/* Keep highlighted lines visible - override the gray */
.remark-code-line-highlighted {
  background-color: rgba(255, 255, 0, 0.5) !important;
}
&lt;/style&gt;





### It's normal to struggle at first but it gets better!

&lt;img src="images/r_first_then_new.png" alt="" width="5136" /&gt;


.fivty[Illustration adapted from [Allison Horst](https://twitter.com/allison_horst)]

&lt;br&gt;

&gt; My experience is that this stuff isn't super easy... but it gets better!







---
 


## Workshop Schedule

| Time | | Topic |
|------|---|-------|
| **10:15 - 11:00** | | Introduction &amp; Creating Packages |
| **11:00 - 11:15** | | **Exercise 1:** Create Your Package |
| | | |
| **11:15 - 11:30** | | *Short Break* â˜• |
| | | |
| **11:30 - 12:00** | | Writing Functions &amp; Documentation |
| | | |
| **12:00 - 13:00** | | *Lunch Break* ğŸ• |
| | | |
| **13:00 - 13:30** | | **Exercise 2:** Document Your Functions |
| **13:30 - 14:15** | | Unit Testing with `testthat` |
| | | |
| **14:15 - 14:30** | | *Short Break* â˜• |
| | | |
| **14:30 - 15:00** | | **Exercise 3:** Write Tests |
| **15:00 - 15:30** | | Sharing Your Package |
| **15:30 - 16:00** | | **Exercise 4:** + Polish |




---

## The Problem with Scripts

.pull-left[
### Sound familiar?

```r
# Load my helper functions
source("helpers.R")
source("utils.R")
source("plotting_functions.R")
source("data_cleaning.R")

# Now I can work...
```

ğŸ˜« Which file has which function?

ğŸ˜« What packages do I need?

ğŸ˜« How do I share this mess?
]

--

.pull-right[
### The R Package Solution

```r
library(mypackage)

# Everything just works!
my_function(data)
```

âœ… One `library()` call

âœ… Dependencies handled

âœ… Documentation built-in

âœ… Easy to share &amp; install
]

---

### Why Even Create an R Package

+ R packages are a wonderful way to make functions and datasets easily accessible for everyone

--

+ R really comes alive because of the many awesome packages that hundreds and hundreds of volunteers help create and maintain

--

+ It's a great way to become active in the R community &amp; give back

--

.center[

![](https://media1.giphy.com/media/5yWTr8kc2O7zaTDhW9/giphy.gif)

]


---

### Before we Start..

+ Creating packages is a process

--

+ There's no need to do everything at once!

--

+ Come up with milestones and focus on reaching them

.center[

![](https://media1.tenor.com/m/Eb0rDBr-4gQAAAAC/new-kids-on-the-block-dancing.gif)

]

---

## When Should You Create a Package?

.key-point[
**Rule of thumb 1:** If you've copy pasted the same code 3 times, it's time for a function!
]
.key-point[
**Rule of thumb 2:** If you've copy-pasted the same function into 3+ projects, it's time for a package!
]

--

### Great candidates for packages:

.pull-left[
**Data Processing**
- Data cleaning pipelines
- API wrappers (common!)

**Analysis**
- Statistical method pipelines
- Simulation functions (e.g. in ABM)
]

.pull-right[
**Visualization**
- ggplot visualizations
- Report templates

**Utilities**
- File handling helpers
- Dataset storage
]

--

&lt;br&gt;

&lt;center&gt;
Or everything together! &lt;b&gt;What are your ideas?&lt;/b&gt;
&lt;/center&gt;

---

## Benefits of Packaging


``` r
                       âŠ‚_ãƒ½
                       ã€€ ï¼¼ï¼¼   Packages
                       ã€€ã€€ ï¼¼( Í¡Â° ÍœÊ– Í¡Â°)
                        ã€€ã€€ã€€ &gt;ã€€âŒ’ãƒ½
                       ã€€ã€€ã€€/ ã€€ ã¸ï¼¼
                       ã€€ã€€ /ã€€ã€€/ã€€ï¼¼ï¼¼give you
                       ã€€ã€€ ï¾šã€€ãƒã€€ã€€ ãƒ½_ã¤
                       ã€€ã€€/ã€€/
                       ã€€ /ã€€/|
                       ã€€(ã€€(ãƒ½
                       ã€€|ã€€|ã€ï¼¼superpowers
                       ã€€| ä¸¿ ï¼¼ âŒ’)
                       ã€€| |ã€€ã€€) /
                       ãƒ )ã€€ã€€Lï¾‰
                       (_ï¼
```


---

### Before we Start..

+ Make sure you installed the latest R and Rstudio version

+ Install the following packages:


``` r
pkgs &lt;- c( "usethis", "devtools", "roxygen2","testthat", "available")
install.packages(pkgs)
```


.pull-left[
&lt;img src="https://usethis.r-lib.org/logo.png" alt="" width="80px" /&gt;

### usethis
Automates package setup and common tasks
]

.pull-right[
&lt;img src="https://devtools.r-lib.org/logo.png" alt="" width="80px" /&gt;

### devtools
Development workflow (build, check, install)
]

--

And now?

--

*Choosing a package name*

![](https://www.wired.com/wp-content/uploads/2016/05/1MINb-ejYCab5RKkhqAplDA-1.gif)

---


### Choosing a Package Name

The `available` package will help check whether your desired package name is still.. well.. available:


``` r
library(available)
available("dimes2026", browse = F)
```

&lt;img src="images/available2.png" alt="" width="1877" /&gt;


---


class: center, middle, inverse


&gt; tfw your chosen package name is still available 

![](https://media.giphy.com/media/l3vR7aXoQX0OdHi48/giphy.gif)



---

class: center, middle, inverse

## Now we're ready to create our first R package!

---

class: center, middle, inverse

## Now we're ready to create our first R package!

### With the help of 

### `usethis`


---



.pull-left[


### `usethis`


The purpose of `usethis` is to

]


.pull-right[


&lt;img src="images/usethis.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

&gt; â€¦ automate repetitive tasks that arise during project setup and development, both for R packages and non-package projects.

--

As you can guess by the description `usethis` is **VERY** useful for package creation and we will be using its functions quite often during development.

--

We're going to focus on two types of functions within `usethis` 
(although there are MANY more)

--

+ `use_*` 
    + for example `use_pipe` to include the pipe operator in your package
+ `create_*`
    + for example `create_from_github` which creates a local Git repository from GitHub


.pull-right[

[`usethis` pkgdown website](https://usethis.r-lib.org/index.html)

]


---


.pull-left[


### Creating your first R Package

The following code will create a *minimal* R package:




]


.pull-right[


&lt;img src="images/usethis.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]


``` r
library(usethis)
create_package("~/dimes2026")
```

All you need to do is specify a `path`. If it exists, it is used. If it does not exist, it is created, provided that the parent path exists.

--

But because *being tidy* is awesome we will be using `create_tidy_package`


``` r
create_tidy_package("~/dimes2026")
```

This function will also create a new package *but* it will also apply many great tidyverse conventions that will come in handy.


---


class: inverse, center, middle

# Package Structure

## What's Inside the Box?

![](https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNXFhNzlpdWs1cnd3NmJlYXVjeHpyYTVqYnNhcXk4d3AzbTI4MHMxciZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/ge91zAgmwUqLMqiH2c/giphy.gif)

---



## Anatomy of an R Package

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

---

## Package Structure: DESCRIPTION

```text
mypackage/
*â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies) 
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The DESCRIPTION file contains essential metadata about your package including name, version, authors, description, and dependencies.

---

## The DESCRIPTION File

### The "ID card" of your package

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

---

## The DESCRIPTION File: Package &amp; Title

```text
*Package: mypackage
*Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

**Package**: Your package name (no spaces, use lowercase). **Title**: A brief, one-line description in Title Case.

---

## The DESCRIPTION File: Version

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
*Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

**Version**: Use semantic versioning (major.minor.patch). Start with 0.1.0 for development, 1.0.0 for first stable release.

---

## The DESCRIPTION File: Authors@R

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
*Authors@R: 
*    person("First", "Last", , "email@example.com", 
*           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

**Authors@R**: Who wrote and maintains the package. Roles: "aut" (author), "cre" (maintainer), "ctb" (contributor).

---

## The DESCRIPTION File: Description

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
*Description: A longer description of what the package does.
*    Use multiple lines if needed. Each line should be indented
*    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

**Description**: A paragraph explaining what your package does. Continuation lines must be indented with 4 spaces.

---

## The DESCRIPTION File: License

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
*License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
Imports: 
    dplyr,
    ggplot2
Suggests: 
    testthat (&gt;= 3.0.0)
```

**License**: How others can use your code. Common: MIT, GPL-3, Apache-2.0. Use `usethis::use_mit_license()` to set up.

---

## The DESCRIPTION File: Imports &amp; Suggests

```text
Package: mypackage
Title: What the Package Does (One Line, Title Case)
Version: 0.1.0
Authors@R: 
    person("First", "Last", , "email@example.com", 
           role = c("aut", "cre"))
Description: A longer description of what the package does.
    Use multiple lines if needed. Each line should be indented
    with 4 spaces. Describe the main functionality.
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.2.3
*Imports: 
*    dplyr,
*    ggplot2
*Suggests: 
*    testthat (&gt;= 3.0.0)
```

**Imports**: Packages your code needs to work. **Suggests**: Optional packages (for tests, vignettes, examples).

---


## Package Structure: NAMESPACE

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
*â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The NAMESPACE file controls which functions are exported (available to users) and imported (from other packages). It's auto-generated by roxygen2, so you don't edit it manually.

---

## The NAMESPACE File

### Controls what's visible

```r
# Export functions for users
export(my_function)
export(another_function)

# Import from other packages
importFrom(dplyr,"%&gt;%")
importFrom(dplyr,filter)
importFrom(ggplot2,ggplot)

# Import entire package namespace
import(stringr)
```

--

.warning[
**Don't edit this file manually!**

`roxygen2` generates it automatically from your documentation comments.
]

---


## Package Structure: LICENSE.md

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
*â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The LICENSE.md file specifies the legal terms under which others can use, modify, and distribute your code. Common licenses include MIT, GPL-3, and Apache 2.0.

---

## Package Structure: README.Rmd / README.md

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
*â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
*â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The README.Rmd is the source file you edit - it allows you to include executable R code examples. Knit it to generate README.md, which is the front page of your package on GitHub.

---

## Package Structure: R/ folder

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
*â”œâ”€â”€ R/                 # Your R functions live here!
*â”‚   â”œâ”€â”€ function1.R
*â”‚   â”œâ”€â”€ function2.R
*â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The R/ folder contains all your package's R code. Each .R file typically contains one or more related functions. This is where the main functionality of your package lives!

---


## The R/ Folder

### Two Ways to Organize

.pull-left[
**One function per file**
```
R/
â”œâ”€â”€ add.R
â”œâ”€â”€ subtract.R
â”œâ”€â”€ multiply.R
â””â”€â”€ divide.R
```

Easy to find, easy to maintain!
]

.pull-right[
**Related functions together**
```
R/
â”œâ”€â”€ arithmetic.R     # add, subtract
â”œâ”€â”€ visualization.R  # plot_*, theme_*
â””â”€â”€ utils.R          # helper functions
```

Group by purpose.
]

&lt;br&gt;

&gt; Use `usethis::use_r()` for creating new R scripts with the correct file name and structure, ensuring they are automatically placed in the R/ folder and ready for documented, exported functions.

---

## Package Structure: man/ folder

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
*â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
*â”‚   â”œâ”€â”€ function1.Rd
*â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The man/ folder contains documentation files (.Rd format) for each function. These are auto-generated from roxygen2 comments in your R code when you run `devtools::document()` and become the help pages users see.

---

## Package Structure: tests/ folder

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
*â”œâ”€â”€ tests/             # Unit tests
*â”‚   â”œâ”€â”€ testthat.R
*â”‚   â””â”€â”€ testthat/
*â”‚       â””â”€â”€ test-function1.R
â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The tests/ folder contains unit tests for your package functions. Tests help ensure your code works correctly and catches bugs early. The `testthat` package is commonly used for testing.

---

## Package Structure: .Rbuildignore

```text
mypackage/
â”œâ”€â”€ DESCRIPTION        # Package metadata (name, version, dependencies)
â”œâ”€â”€ NAMESPACE          # What to export/import (auto-generated)
â”œâ”€â”€ LICENSE.md         # How others can use your code
â”œâ”€â”€ README.Rmd         # Source file for README (knit this!)
â”œâ”€â”€ README.md          # Package overview for GitHub (auto-generated)
â”œâ”€â”€ R/                 # Your R functions live here!
â”‚   â”œâ”€â”€ function1.R
â”‚   â”œâ”€â”€ function2.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ man/               # Documentation (auto-generated by roxygen2)
â”‚   â”œâ”€â”€ function1.Rd
â”‚   â””â”€â”€ function2.Rd
â”œâ”€â”€ tests/             # Unit tests
â”‚   â”œâ”€â”€ testthat.R
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-function1.R
*â””â”€â”€ .Rbuildignore      # Files to exclude from package build
```

The .Rbuildignore file lists files and directories that should be excluded when building the package. This typically includes development files, README.Rmd, and other non-essential items.

---


### Creating your first R Package

Finally, the following two lines of code will set up Git and a GitHub repository for your package: 



``` r
use_git()
use_github()
```


This is important because people need to be able to install your package from a public source. GitHub is primary source for that but there are others (Gitlab for example).

--

Once you have run the two code pieces above you can do the following to install an already fully functioning R package on your computer.


``` r
devtools::install_github("{github_username}/{packagename}")
```

---

class: center, middle, inverse

## Exercise 1

![](https://media1.tenor.com/images/72bf7922ac0b07b2f7f8f630e4ae01d2/tenor.gif?itemid=11364811)



---

# Exercise 1

Create your own R package

1. use `available` to check if the name is still available
2. use `create_tidy_package("~/PACKAGENAME")` to create your package
3. Explore the package structure, update the `DESCRIPTION` to match your info and package purpose

Bonus points (only if you have GitHub set up with RStudio): 



``` r
use_git()
use_github()
```

and install your package from GitHub



``` r
devtools::install_github("{github_username}/{packagename}")
```

--

This should be about ~10 minutes :) 

---

class: center, middle, inverse

## Congratulations you created your very first R package!

![](https://media.giphy.com/media/XGJY5KLuazndauTfZP/giphy.gif)



---

class: center, middle, inverse

![](http://fabian-brunke.com/portfolio-2019/wp-content/themes/portfolio/coming_soon.gif)

## Let's start adding functions to our package!

--

By first of all talking about how to *name* our functions

---


## Naming Functions

The `rOpenSci Package guide` states that:

&gt; Functions and arguments naming should be chosen to work together to form a common, logical programming API that is easy to read, and auto-complete.

--

So in the best case scenario you come up with a naming scheme in the following style:

+ `object_verb`

This scheme 

+ helps avoid namespace conflicts with packages that may have similar verbs
+ makes code readable and easy to auto-complete

--

For example `stringr` functions all start with `str_*` whereas `memer` functions all start with `meme_*`.

In our examples here we won't be using this naming style just for convenience but in your personal package you should absolutely consider using it!


---


## Creating your first Function in your Package

In order to get started with our first function we will create a new R script with the help of the `usethis` package:


``` r
use_r("greeting")
```

This will create and open a `greeting.R` file in your package's R subfolder; the place where all the functions of your package will live!

--

If you need a refresher in regards to how R function work, click below

&gt; [DS3 Workshop Intro to R - On Functions](https://favstats.github.io/ds3_r_intro/#90)

---



## Creating your first Function in your Package

In order to get started with our first function we will create a new R script with the help of the `usethis` package:


``` r
use_r("greeting")
```

This will create and open a `greeting.R` file in your package's R subfolder; the place where all the functions of your package will live!


Let's create a simple greeting function:


``` r
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```


``` r
greet("World")
```
```
[1] "Hello, World"
```

---


## Loading Your Package Functions: `load_all()`

But how do you actually *use* your functions while developing?


``` r
# Load all functions from your package into R
devtools::load_all()
```

--

### What does `load_all()` do?

- Simulates installing and loading your package
- Makes all your R/ functions available in your workspace
- Also loads any data and runs code in R/zzz.R

--

### Why use it?

- **Fast iteration**: No need to reinstall the package after every change
- **Test as you go**: Write a function â†’ `load_all()` â†’ test it â†’ repeat
- **Keyboard shortcut**: In RStudio, press `Ctrl+Shift+L` (or `Cmd+Shift+L` on Mac)

---

## Pro Tip: Create a `dev/` Folder for Testing

While developing, you'll want a place to write exploratory scripts that **won't** be included in your package.


``` r
# Create a dev/ folder and add it to .Rbuildignore in one step!
usethis::use_directory("dev", ignore = TRUE)
```

What goes in `dev/`?

Scripts to test functions, code snippets, development notes etc.

--

### Example Script


``` r
# Load all package functions
devtools::load_all()

# Test the greet function
greet("Fabio")
greet("Workshop", excited = TRUE)
```

This keeps your experimentation separate from your actual package code!

---



class: center, middle, inverse

### But *how* do we communicate what functions do
### to people who use our package? 

---

## Documentation

With the help of *D O C U M E N T A T I O N*, of course!



``` r
                       always
                       âŠ‚_ãƒ½
                       ã€€ ï¼¼ï¼¼   document
                       ã€€ã€€ ï¼¼( Í¡Â° ÍœÊ– Í¡Â°)
                        ã€€ã€€ã€€ &gt;ã€€âŒ’ãƒ½
                       ã€€ã€€ã€€/ ã€€ ã¸ï¼¼
                       ã€€ã€€ /ã€€ã€€/ã€€ï¼¼ï¼¼your
                       ã€€ã€€ ï¾šã€€ãƒã€€ã€€ ãƒ½_ã¤
                       ã€€ã€€/ã€€/
                       ã€€ /ã€€/|
                       ã€€(ã€€(ãƒ½
                       ã€€|ã€€|ã€ï¼¼functions
                       ã€€| ä¸¿ ï¼¼ âŒ’)
                       ã€€| |ã€€ã€€) /
                       ãƒ )ã€€ã€€Lï¾‰
                       (_ï¼
```

---



.pull-left[


## Documentation


Documentation is absolutely *central*. 

]


.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]


It's basically the guidance for your users so they know how to use the functions within your package.

--

Or as Hadley Wickham puts it:

&gt; Documentation is one of the most important aspects of good code. Without it, users wonâ€™t know how to use your package, and are unlikely to do so. 

--

There is a built-in functionality within R to document packages: `.Rd` files that are stored in the `man` subdirectory of your package. These files use a syntax that is similar to Latex.

Here to help us with documentation is `roxygen2` which *conveniently* creates a lot of the necessary files with its own more intuitive syntax style.

---


.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]


.ninety[
This is how documentation for our `greet` function might look like:


``` r
#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```
]

--

Oi. This looks.. *different*. So what is actually going on here? 

Let's take a look at what this piece of roxygen code will generate.

---

.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

&lt;img src="images/add.png" alt="" width="600" height="350" style="display: block; margin: auto;" /&gt;

Ah. This looks more familiar!

Let's go through the original roxygen code line by line to understand it better.

---

.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

.ninety[
The first line of code highlighted here shows the title. 


``` r
*#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

This is a (very) short description of your function.
]

---



.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

.ninety[
You might have noticed this odd code in front of the documentation: `#'`


``` r
#' Greet a person
*#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

Roxygen comments start with this symbol in order to distinguish them from your usual comments (`#`)
]

---

.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]


.ninety[
Next up is the `@param` name descriptions for our functions.


``` r
#' Greet a person
#'
*#' @param name A character string with the person's name.
*#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

These lines of code describe the functionâ€™s inputs or *parameters*. The description usually documents what the parameter does, what the default inputs are (if any) and what the object type should ideally be (e.g., string, numeric vector etc.).
]



---


.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]


.ninety[
We continue with the `@return` name description.


``` r
#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
*#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

The `@return` tag simply describes the output from the function.
]

---

.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

.ninety[
We continue with the `@return` name description.


``` r
#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
*#' @return A character string with the greeting.
#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

The `@return` tag simply describes the output from the function.

Since we used `create_tidy_package` we also turned on *markdown* style syntax within our roxygen descriptions.
]

---


.pull-left[


## Documentation

]



.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

.ninety[
Next up is the `@export` tag.


``` r
#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
*#' @export
#'
#' @examples
#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

This one is pretty straightforward. If you want your functions to be available to the user (and not just create an internal function to be used within the package) then it is crucial to add the `@export` tag.
]

---

.pull-left[


## Documentation

]


.pull-right[


&lt;img src="images/roxygen2.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

.ninety[
Finally, the `@examples` tag.


``` r
#' Greet a person
#'
#' @param name A character string with the person's name.
#' @param excited Logical. Add exclamation marks? Default FALSE.
#'
#' @return A character string with the greeting.
#' @export
#'
*#' @examples
*#' greet("R User", excited = TRUE)
greet &lt;- function(name, excited = FALSE) {
  msg &lt;- paste0("Hello, ", name)
  if (excited) {
    msg &lt;- paste0(msg, "!!!")
  }
  msg
}
```

Adding examples to functions can *really* help your users figure out how your package is *meant* to be used.
]

---

.pull-left[


## Documentation

]


.pull-right[


&lt;img src="images/devtools.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

With this, the roxygen code for your documentation is done. The last thing to do is converting your description to `.Rd` files so it can appear in the help file.

Luckily, with the help of the `devtools` package this step is *really* easy to do.

Just type in the following code:


``` r
library(devtools)
document()
load_all()
```


``` r
Updating dimes2026 documentation
Writing NAMESPACE
Loading dimes2026
Writing NAMESPACE
Writing greet.Rd
```

After running `document()` to generate the help files, run `load_all()` to load your package. Then type `?greet` to see your documentation!

---

## The Development Workflow


``` r
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                 â”‚
    â”‚   1. Edit code in R/                            â”‚
    â”‚          â”‚                                      â”‚
    â”‚          â–¼                                      â”‚
    â”‚   2. document()  â”€â”€â”€ generates man/ &amp; NAMESPACE â”‚
    â”‚          â”‚                                      â”‚
    â”‚          â–¼                                      â”‚
    â”‚   3. load_all()  â”€â”€â”€ loads package for testing  â”‚
    â”‚          â”‚                                      â”‚
    â”‚          â–¼                                      â”‚
    â”‚   4. Test interactively in dev/                 â”‚
    â”‚          â”‚                                      â”‚
    â”‚          â–¼                                      â”‚
    â”‚   5. Repeat! â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


.ninety[
**Keyboard shortcuts:**
- `Ctrl/Cmd + Shift + D` = `document()`
- `Ctrl/Cmd + Shift + L` = `load_all()`
]
---

class: center, middle, inverse

## That's it! 
## We created our very first function documentation!

![](https://media0.giphy.com/media/5aWC7vyZtQIoLemw1R/giphy.gif)

---



## roxygen2 Tags Reference

| Tag | Purpose | Required? |
|-----|---------|-----------|
| `@param` | Document arguments | Yes (for each arg) |
| `@return` | Describe output | Yes |
| `@export` | Make public | If user-facing |
| `@examples` | Usage examples | Highly recommended |
| `@importFrom` | Import functions | When needed |
| `@seealso` | Related functions | Helpful |
| `@details` | Extended description | For complex functions |
| `@section` | Custom sections | Optional |
| `@family` | Group related functions | Nice to have |

---

## Complete Documentation Example

.seventy[

``` r
#' Calculate summary statistics
#'
#' Computes common summary statistics for a numeric vector,
#' including mean, median, standard deviation, and range.
#'
#' @param x A numeric vector.
#' @param na.rm Logical. Should NA values be removed? Default `TRUE`.
#' @param digits Integer. Number of decimal places. Default 2.
#'
#' @return A named list with components:
#' \describe{
#'   \item{mean}{Arithmetic mean}
#'   \item{median}{Median value}
#'   \item{sd}{Standard deviation}
#'   \item{range}{Vector of min and max}
#' }
#'
#' @export
#'
#' @examples
#' x &lt;- c(1, 2, 3, 4, 5, NA)
#' summarize_stats(x)
#' summarize_stats(x, digits = 4)
#'
#' @seealso [mean()], [sd()] for individual statistics
summarize_stats &lt;- function(x, na.rm = TRUE, digits = 2) {
  list(
    mean = round(mean(x, na.rm = na.rm), digits),
    median = round(median(x, na.rm = na.rm), digits),
    sd = round(sd(x, na.rm = na.rm), digits),
    range = round(range(x, na.rm = na.rm), digits)
  )
}
```
]

---

## Using Other Packages

.eightyfive[
### Option 1: `package::function()` (Explicit)


``` r
#' Process data
#' @export
process_data &lt;- function(data) {
* dplyr::filter(data, !is.na(value)) %&gt;%
*   dplyr::mutate(log_value = log(value))
}
```

Clear where each function comes from. Preferred for occasional use.


### Option 2: `@importFrom` (Cleaner code)


``` r
*#' @importFrom dplyr filter mutate %&gt;%
#' @export
process_data &lt;- function(data) {
  filter(data, !is.na(value)) %&gt;%
    mutate(log_value = log(value))
}
```

Cleaner code, but need to remember to import.
]

---

## The Pipe: Special Case

### Add pipe to your package


``` r
# Run this once
use_pipe()
```

This creates `R/utils-pipe.R`:


``` r
#' Pipe operator
#'
#' @name %&gt;%
#' @rdname pipe
#' @keywords internal
#' @export
#' @importFrom magrittr %&gt;%
#' @usage lhs \%&gt;\% rhs
NULL
```

```
## NULL
```

Now `%&gt;%` works in your package AND users can use it!

---

## Data Documentation

.eighty[
### Include datasets in your package


``` r
# Save data to data/ folder
use_data(my_dataset)
```

### Document it


``` r
#' Sample survey data
#'
#' A dataset containing simulated survey responses.
#'
#' @format A data frame with 500 rows and 5 variables:
#' \describe{
#'   \item{id}{Respondent ID}
#'   \item{age}{Age in years}
#'   \item{satisfaction}{Satisfaction score (1-5)}
#'   \item{department}{Department name}
#'   \item{date}{Survey date}
#' }
#' @source Simulated data for demonstration purposes.
"my_dataset"
```

Save this as `R/data.R`.
]

---

class: center, middle, inverse


However...

this is not everything of course.

There are so much more things to know about documentation!

I recommend the following sources:

[Introduction to roxygen2](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html)

[Object documentation chapter from R Packages book](http://r-pkgs.had.co.nz/man.html)

---



class: center, middle, inverse

## Exercise 2

![](https://media1.tenor.com/images/72bf7922ac0b07b2f7f8f630e4ae01d2/tenor.gif?itemid=11364811)

---

## Exercise 2: Add Function(s)

Create a function (or multiple!) which does something useful for you!

Ideas:
- A ggplot visualization
- A data cleaning helper
- A calculation you do often


``` r
use_r("my_function")
```

Don't forget documentation with `devtools::document()`!


~30 minutes

&lt;br&gt;

If you need a refresher in regards to how R function work, click below

&gt; [DS3 Workshop Intro to R - On Functions](https://favstats.github.io/ds3_r_intro/#90)


---


class: center, middle, inverse

## Next up:

## Just `testthat`

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]



``` r
    ï¼œâŒ’ï¼ãƒ½-ï½¤ï¼¿
    ï¼ï¼œ_/ï¼¿ï¼¿ï¼¿ï¼¿ï¼
    
    
    'I cant sleep if you dont test your functions'
    ã€€ã€€ã€€âˆ§_âˆ§
    ã€€ã€€ (ã€€ï½¥Ï‰ï½¥)ã€€
    ã€€ ï¼¿|ã€€âŠƒï¼(ï¼¿ï¼¿_
    ï¼ã€€â””-(ï¼¿ï¼¿ï¼¿_ï¼
    ï¿£ï¿£ï¿£ï¿£ï¿£ï¿£ï¿£
```

Testing is really important to make sure your package is functioning as intended.

--

As you keep developing and adding to your package code, keeping track of what might go wrong will become more and more complex. 

--

Unit tests will help you with identifying issues within your code so you can pinpoint what went wrong and where.



---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

The basic setup of an unit testing is quite simple:

You write up example code with your package functions and define specific outputs that you expect. 

1. If they are met, great, the test is passed! 
2. If not, the test fails and you will know that something is wrong with your code and what failed.

--

To set up unit tests for your package with `testthat` you can simply run `use_testthat` (from our beloved `usethis` package):


``` r
use_testthat()
```

--

This will create a folder `tests` and a subfolder `testthat`. This is the folder where your tests will live.

Since we created our package with `create_tidy_package` we don't need to run this part as this function automatically sets up `testthat`.

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

How do set up individual tests?

`usethis` got us covered again!

Simply run this code:


``` r
use_test("greeting")
```

--

This will create the following file:


``` r
tests/testthat/test-greeting.R
```

--

With this content:


``` r
test_that("multiplication works", {
  expect_equal(2 * 2, 4)
})
```

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

Let's take this short code apart:


``` r
test_that("multiplication works", {
  expect_equal(2 * 2, 4)
})
```

```
## Test passed ğŸŠ
```

In the first line of code we can see the function `test_that` which is our main tool for unit tests.

--

The first argument of `test_that` describes what is supposed to be tested whereas the second argument encapsulates the code to be tested within a curly bracket `{}` environment.

--

Within this environment we write up our expectations with the help of `testthat`'s `expect_*` functions, of which there are many.

--

In this case we use `expect_equal` which is quite straightforward. The 1st argument should be equal to the 2nd argument and if it's not, the test fails.



---

### `expect_*()` Functions

.small[
| Function | Checks |
|----------|--------|
| `expect_equal()` | Values equal (with tolerance) |
| `expect_identical()` | Exactly identical |
| `expect_true()` / `expect_false()` | Boolean value |
| `expect_null()` | Value is NULL |
| `expect_type()` | Object type (e.g., "character") |
| `expect_s3_class()` | S3 class (e.g., "data.frame") |
| `expect_length()` | Correct length |
| `expect_match()` | Matches regex pattern |
| `expect_error()` | Error thrown |
| `expect_warning()` | Warning thrown |
| `expect_message()` | Message printed |
]

---

## You ready?

![](https://media1.tenor.com/images/bd7d6b583e936c6bc2f279b57d3005a5/tenor.gif?itemid=13422464)

## Good. Because we are now designing our own test for the `greet` function.


---


.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

Alright. So let's start testing our `greet` function.

First, we will test whether greeting works as intended:


``` r
test_that("greeting works as intended", {
  
  result &lt;- greet("World")
  
  expect_equal(result, "Hello, World")
})
```

```
## Test passed ğŸŒˆ
```

The test did not throw an error so this worked. Perfect!

---




.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

How about testing that the `excited` parameter adds exclamation marks?


``` r
test_that("excited parameter adds exclamation marks", {
  
  result &lt;- greet("R User", excited = TRUE)
  
  expect_equal(result, "Hello, R User!!!")
  
})
```

```
## Test passed ğŸ¥³
```

Again, this ran without problems. So everything went as we expected!

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

&lt;br&gt;

.center[

Now, let's try to break our tests!

![](http://i.giphy.com/klPeFHrWqzPDW.gif)
]

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

Let's try to test if greeting returns "Hi" instead of "Hello":


``` r
test_that("greeting starts with Hi", {
  
  result &lt;- greet("World")
  
  expect_match(result, "^Hi")
  
})
```

--


``` r
Error: Test failed: 'greeting starts with Hi'
* `result` does not match "^Hi".
Actual value: "Hello, World"
```

Success! We failed! Since `greet()` returns "Hello, World" (not "Hi, World"), the test fails and we receive an informative error message.

---

.pull-left[

## Unit Testing

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

It takes a little bit of creativity to foresee the many ways functions within your package might break.

In practice, writing the right kind of unit tests is considered sort of an [art](https://www.manning.com/books/the-art-of-unit-testing-second-edition) by some and a nuisance by others.

In any case though it is really important for writing robust code that can be relied upon.


---

## MORE Tests for Our `greet()` Function


``` r
test_that("greeting always starts with Hello", {
  expect_match(greet("Anyone"), "^Hello")
  expect_match(greet("Anyone", excited = TRUE), "^Hello")
})

test_that("excited greeting ends with exclamation marks", {
  result &lt;- greet("Test", excited = TRUE)
  expect_match(result, "!!!$")
})

test_that("greeting contains the name provided", {
  expect_match(greet("Fabio"), "Fabio")
  expect_match(greet("Workshop Participants"), "Workshop Participants")
})

test_that("non-excited greeting has no exclamation marks", {
  result &lt;- greet("Calm Person", excited = FALSE)
  expect_false(grepl("!", result))
})
```

---

.pull-left[

## Unit Testing

Now, we have successfully written up three tests for our `greet` function.

]


.pull-right[


&lt;img src="images/testthat.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]

 

The `devtools` package will help us test all of our unit tests at once by running the following code within your package project:


``` r
test()
```

&lt;img src="images/test.png" alt="" width="1307" /&gt;


---

.pull-left[

## Bringing it all together


We can also run `check` from `devtools` to test pretty much everything about our package:


]


.pull-right[


&lt;img src="images/devtools.png" alt="" width="100" height="120" style="display: block; margin: auto 0 auto auto;" /&gt;

]



``` r
check()
```

&lt;img src="images/check.png" alt="" width="1319" /&gt;


---


class: center, middle, inverse


And when your package passes all checks you get the sweet feeling of getting the following feedback:


&lt;img src="images/check_results.png" alt="" width="827" /&gt;



---

##Useful Stuff: Test-Driven Development (TDD)

### Write the test FIRST, then the code


``` r
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                          â”‚
    â”‚   1. Write a failing test ğŸ”´             â”‚
    â”‚          â”‚                               â”‚
    â”‚          â–¼                               â”‚
    â”‚   2. Write minimal code to pass ğŸŸ¢       â”‚
    â”‚          â”‚                               â”‚
    â”‚          â–¼                               â”‚
    â”‚   3. Refactor &amp; improve ğŸ”µ               â”‚
    â”‚          â”‚                               â”‚
    â”‚          â–¼                               â”‚
    â”‚   4. Repeat! â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

--

.tip[
TDD forces you to think about **what** your function should do before **how** to implement it.
]

---
class: center, middle, inverse

## Exercise 3

![](https://media1.tenor.com/images/72bf7922ac0b07b2f7f8f630e4ae01d2/tenor.gif?itemid=11364811)


---

## Exercise 3: Write Tests


``` r
use_test("my_function")
```

Write at least 3 tests:
1. Normal case works
2. Edge case handled
3. Error case handled


``` r
test_that("my_function works correctly", {
  expect_equal(my_function(input), expected_output)
})
```


~30 minutes

---

class: inverse, center, middle

# Getting Your Package Out There

![](https://media.giphy.com/media/Is1O1TWV0LEJi/giphy.gif)


---

## Creating a README

(this already exists with `create_tidy_package()`)


``` r
# Create README.Rmd (editable) -&gt; README.md (for GitHub)
use_readme_rmd()
```

### Good README structure:

1. **Package name &amp; badges**
2. **What it does** (1-2 sentences)
3. **Installation instructions**
4. **Quick example**
5. **Links to documentation**

--


``` r
# After editing README.Rmd, regenerate README.md
build_readme()
```

---

## Adding Badges


``` r
# CRAN badge (if on CRAN)
use_cran_badge()

# Lifecycle badge
use_lifecycle_badge("experimental")  # or stable, maturing, etc.
```

--

Your README gets fancy badges! ğŸ…

![](https://img.shields.io/badge/CRAN-0.1.0-blue) ![](https://img.shields.io/badge/lifecycle-experimental-orange) ![](https://img.shields.io/badge/R--CMD--check-passing-brightgreen) ![](https://img.shields.io/badge/coverage-85%25-yellowgreen)

---

## pkgdown: Beautiful Documentation Sites


``` r
# Set up pkgdown
use_pkgdown()

# Build the site
pkgdown::build_site()
```

--

Creates a professional website with:
- Function reference
- Vignettes as articles
- News/changelog
- Search functionality

--

### Deploy to GitHub Pages


``` r
use_pkgdown_github_pages()
```

Your docs live at: `https://username.github.io/packagename/`

---

## Vignettes: Long-Form Documentation


``` r
# Create a vignette
use_vignette("getting-started")
```

```yaml
---
title: "Getting Started with mypackage"
output: rmarkdown::html_vignette
vignette: &gt;
  %\VignetteIndexEntry{Getting Started with mypackage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```

--

Vignettes are **tutorials** showing:
- Workflows
- Use cases
- Integration with other packages
- Best practices

---

## CRAN Submission (Optional)

### Requirements:

1. âœ… Pass `R CMD check` with 0 errors, 0 warnings, minimal notes
2. âœ… Documentation complete
3. âœ… Examples run without errors
4. âœ… Tests pass
5. âœ… No copyrighted content
6. âœ… cran-comments.md explains any notes

--

### Submit:


``` r
# Final check as CRAN would run it
devtools::check(remote = TRUE, manual = TRUE)

# Submit to CRAN
devtools::release()
```


---

class: center, middle, inverse

## BONUS Exercise 4

![](https://media1.tenor.com/images/72bf7922ac0b07b2f7f8f630e4ae01d2/tenor.gif?itemid=11364811)


---

## BONUS Exercise 4: Polish &amp; Share

1. Edit README.Rmd

2. Build README: `build_readme()`

3. Optional: `use_pkgdown()` and `build_site()`

4. Push to GitHub

5. Test installation: `devtools::install("yourusername/yourpackage")`


~30 minutes

---

## Useful stuff that I wasn't able to mention yet

Add Package imports to `DESCRIPTION` with `usethis::use_package`:


``` r
use_package("dplyr")
```



---


## Code Coverage

### How much of your code is tested?


``` r
# Install covr
install.packages("covr")

# Check coverage
covr::package_coverage()
```

```
mypackage Coverage: 85.71%
R/greeting.R: 100.00%
R/divide.R: 75.00%
```

--

.tip[
Aim for 80%+ coverage, but don't obsess. **Quality &gt; Quantity**.

Test the important paths, edge cases, and error handling.
]

---


## Continuous Integration with GitHub Actions


``` r
# Standard R CMD check on multiple platforms
use_github_actions()
```

Creates `.github/workflows/R-CMD-check.yaml`

Every push/PR automatically:
- Checks on Windows, Mac, Linux
- Tests on multiple R versions
- Reports status

--

.key-point[
CI catches issues **before** they reach users.
"Works on my machine" â†’ "Works everywhere"
]

---

## Version Numbers

### Semantic Versioning: MAJOR.MINOR.PATCH

| Version | When to Bump |
|---------|--------------|
| **0.1.0** â†’ **0.2.0** | New features (backward compatible) |
| **0.2.0** â†’ **0.2.1** | Bug fixes only |
| **0.9.0** â†’ **1.0.0** | Stable release, public API |
| **1.0.0** â†’ **2.0.0** | Breaking changes |

--

### Development versions

```r
# In DESCRIPTION
Version: 0.1.0.9000
```

The `.9000` suffix indicates development version.

---


## Some More Resources
 
+ [Writing an R Package from Scratch (Hilary Parker)](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/)

+ [Writing an R Package from Scratch (Tomas Westlake)](https://r-mageddon.netlify.com/post/writing-an-r-package-from-scratch/)

+ [usethis workflow for package development](https://www.hvitfeldt.me/blog/usethis-workflow-for-package-development/)

+ [R packages by Hadley Wickham](http://r-pkgs.had.co.nz/)

+ [rOpenSci Packages: Development, Maintenance, and Peer Review](https://devguide.ropensci.org/)

+ [R Packages cheatsheet](https://rawgit.com/rstudio/cheatsheets/master/package-development.pdf)

+ [Generating .Rd files (roxygen2)](https://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html)

+ [Writing R Extensions]()

+ [usethis website](https://usethis.r-lib.org/index.html)

+ [testthat website](https://testthat.r-lib.org/)



---


class: inverse, center, middle

# You Did It!

## You're Now an R Package Developer! ğŸ‰

![](https://media.giphy.com/media/3oz8xIsloV7zOmt81G/giphy.gif)

For being part of this workshop!


---

## Appendix: Key roxygen2 Tags

.eigthy[
```
@param name Description    # Document arguments
@return Description        # What function returns  
@export                    # Make public
@examples                  # Runnable examples
@importFrom pkg fun        # Import specific function
@import pkg                # Import whole package (use sparingly)
@seealso [function()]      # Related functions
@details                   # Extended description
@section Title:            # Custom section
@family name               # Group related functions
@inheritParams function    # Copy params from another function
@rdname name               # Combine docs for multiple functions
@keywords internal         # Mark as internal (not indexed)
@noRd                      # No .Rd file generated
```
]

---

## Appendix: testthat Expectations

.seventy[
```r
# Equality
expect_equal(x, y)           # x equals y (with tolerance)
expect_identical(x, y)       # x exactly equals y
expect_equivalent(x, y)      # x equals y (ignoring attributes)

# Type/class
expect_type(x, "character")  # typeof(x) == "character"
expect_s3_class(x, "data.frame")
expect_s4_class(x, "MyClass")

# Logic
expect_true(x)               # x is TRUE
expect_false(x)              # x is FALSE
expect_null(x)               # x is NULL

# Errors/warnings
expect_error(f(), "message") # f() throws error matching "message"
expect_warning(f())          # f() throws warning
expect_message(f())          # f() prints message
expect_silent(f())           # f() produces no output

# Collections
expect_length(x, n)          # length(x) == n
expect_named(x, c("a", "b")) # names match
expect_contains(x, y)        # x contains y

# Comparison
expect_lt(x, y)              # x &lt; y
expect_lte(x, y)             # x &lt;= y
expect_gt(x, y)              # x &gt; y
expect_gte(x, y)             # x &gt;= y
```
]

---

## Appendix: devtools Functions

.eighty[
```r
# Loading
load_all()                   # Load package for testing
unload()                     # Unload package

# Documentation  
document()                   # Generate man/ and NAMESPACE
build_readme()               # Render README.Rmd

# Testing
test()                       # Run all tests
test_active_file()           # Test current file
test_coverage()              # Check code coverage

# Checking
check()                      # Full R CMD check
check_man()                  # Check documentation only
spell_check()                # Check spelling

# Building
build()                      # Build package tarball
install()                    # Install locally

# Releasing
release()                    # Submit to CRAN
submit_cran()                # Submit to CRAN (alternative)

# Vignettes
build_vignettes()            # Build all vignettes
```
]




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "slideNumberFormat": "%current%<br>",
  "ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
